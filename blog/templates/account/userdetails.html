{% extends "base.html" %}
{% load thumbnail %}
{% load static %}

<link href="{% static "css/profile.css" %}" rel="stylesheet">

{% block title %}User Details{% endblock %}

{% block content %}
<style>
  
*,
*::before,
*::after {
    box-sizing: border-box;
}
.container {
    max-width: 93.5rem;
    margin: 0 auto;
}
img {
    display: block;
}
.btn {
    display: inline-block;
    font: inherit;
    background: none;
    border: none;
    color: inherit;
    padding: 0;
    cursor: pointer;
}
.btn:focus {
    outline: 0.5rem auto #4d90fe;
}
.visually-hidden {
    position: absolute !important;
    height: 1px;
    width: 1px;
    overflow: hidden;
    clip: rect(1px, 1px, 1px, 1px);
}
/* Profile Section */

.profile {
    padding: 5rem 0;
    margin-top:-20px;
}
.profile::after {
    content: "";
    display: block;
    clear: both;
}
.profile-image {
    justify-content: center;
    align-items: center;
    margin-right: 3rem;
}

.profile-image img {
    border-radius: 50%;
}
.list-inline {
    display: flex;
    padding-left: 0;
    list-style: none;
    margin-bottom: -30px;
}
.profile-user-settings,
.profile-bio {
    float: left;
    width: calc(66.666% - 2rem);
}
.profile-stats{
  display: inline-grid;
  margin-top: 10px;
  margin-bottom: -20px;

}
.profile-user-settings {
    margin-top: 1.1rem;
    display: inline-grid;
}
.profile-user-name {
    font-size: 3.2rem;
    font-weight: 300;
    padding-left: 20px;
    margin-top: -20px;
    display: inline-flex;
}
.profile-edit-btn {
    font-size: 1.4rem;
    line-height: 1.8;
    border: 0.1rem solid #dbdbdb;
    border-radius: 0.3rem;
    padding: 0 2.4rem;
    margin-left: 2rem;
}
.profile-settings-btn {
    font-size: 2rem;
    margin-left: 1rem;
}



.profile-bio {
    font-size: 1.6rem;
    font-weight: 400;
    line-height: 1.5;
    margin-top: 2.3rem;
}

.profile-real-name,
.profile-stat-count,
.profile-edit-btn {
    font-weight: 600;
}
</style>
{% comment %} side bar {% endcomment %}
    {% include 'account/sidebar.html'%}
{% comment %} end side bar {% endcomment %}
<div id="content" class="p-4 p-md-5 pt-5">
  <div class="container pm">
		<div class="profile">
			<div class="profile-image">
              <img src="{% thumbnail user.profile.photo 180x180 %}" class="user-detail">
            <div class="profile-user-settings">
				      <h1 class="profile-user-name">{{ user.get_full_name }}</h1>
				      <button class="btn profile-edit-btn">Edit Profile</button>
				      <button class="btn profile-settings-btn" aria-label="profile settings"><i class="fas fa-cog" aria-hidden="true"></i></button>
		      	</div>
            <div class="profile-stats">
            <ul class="list-inline _3dehb">
              <li class="list-inline-item lh36i">
                {% with total_followers=user.followers.count %}
                  <span class="count">
                    <span class="profile-stat-count total">{{ total_followers }}</span>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalLong1">
                        Follower{{ total_followers|pluralize }}
                    </button> 
                  </span>
                {% endwith %}
              </li>
              
                <li class="list-inline-item lh36i">
                  {% with total_following=user.following.count %}
                    <span class="count">
                      <span class="profile-stat-count total1">{{ total_following }}</span>
                      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalLong"> 
                      Following{{ total_following|pluralize }}
                      </button> 
                    </span>
                  {% endwith %}
                </li>
                <li class="list-inline-item lh36i"><span class="profile-stat-count">{{total_post}}</span> Posts</li>
                <li class="list-inline-item lh36i">
                    <a href="{% url 'posts:user_follow' %}" data-id="{{ user.id }}" data-action="{% if request.user in user.followers.all %}un{% endif %}follow" class="follow button">
                    {% if request.user not in user.followers.all %}
                        Follow
                    {% else %}
                        Unfollow
                    {% endif %}
              </a>
                </li>
              </ul>
			      </div>
            
              
            
          <div class="profile-bio">
				    <p><span class="profile-real-name">Jane Doe</span> Lorem ipsum dolor sit, amet consectetur adipisicing elit üì∑‚úàÔ∏èüèïÔ∏è</p>
			    </div>
      </div>
     </div>
    </div>
    <hr style="width:100%; color:red;"/>
  <div class="container">
    <div class="col-lg-12">
     <div class="row mt-2">
        {% for story in stories %}
            
            {% if story.avatar %}
                <div class="col-3">
                    <img src="{{ story.avatar.url }}" 
                         alt="avatar" 
                         style="max-width:100%; border-radius: 20px"
                    >
                </div>
            {% endif %}

            <div class="col">
                

                <!-- Ê†áÁ≠æ -->
                <span>
                    {% for tag in story.tags.all %}
                        <a href="{% url 'posts:post_list' %}?tag={{ tag }}"
                           class="badge badge-secondary" 
                        >
                            {{ tag }}
                        </a>
                    {% endfor %}
                </span>

                <!-- title -->
                <h4>
                    <b>
                        <a href="{% url 'posts:post_detail' story.id %}"
                           style="color: black;" 
                        >
                            {{ story.title }}
                        </a>
                    </b>
                </h4>
                <!--Summary-->
                <div>
                    <p style="color: gray;">
                        {{ story.body|slice:'100' }}...
                    </p>
                </div>
                <!-- Footnote -->
                <p>
                    <!-- extra information -->
                    <span>
                        <i class="fas fa-eye" style="color: lightskyblue;"></i>
                        {{ story.total_views }}&nbsp;&nbsp;&nbsp;
                    </span>
                    <span>
                        <i class="fas fa-comments" style="color: yellowgreen;"></i>
                        {{ story.comments.count }}&nbsp;&nbsp;&nbsp;
                    </span>
                    <span>
                        <i class="fas fa-clock" style="color: pink;"></i>
                        <!--
                        {{ article.created|date:'Y-m-d' }}
                        -->
                        {{ story.created|date:'Y-m-d' }}
                    </span>
                </p>
            </div>
            <hr style="width: 100%;"/>
        {% endfor %}
    </div>

    </div>

    </diV>

</div>
{% comment %}--------------------- follower model--------------------------------- {% endcomment %}
<!-- Modal -->
<div class="modal fade" id="exampleModalLong1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          {% for follow in user.followers.all %} 
              <a href="{% url 'posts:user_detail' follow.username %}" class="title"> {{ follow.username }}
             </a>
              {{follow.first_name}}
          {% endfor %}
          
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
{% comment %} -----------------end follower model--------------------------------- {% endcomment %}

{% comment %} ------------------------following model -------------------------- {% endcomment %}
<!-- Modal -->
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          {% for follow in user.following.all %} 
             <a href="{% url 'posts:user_detail' follow.username %}" class="title"> {{ follow.username }}
             </a>
              {{follow.first_name}}
          {% endfor %}
          {% for photo in user.profile.all %}
              <img src={{photo}} />
          {% endfor %}
         
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% comment %} ------------------------end following model ---------------------- {% endcomment %}

{% endblock %}

{% block domready %}
  $('a.follow').click(function(e){
    e.preventDefault();
    $.post('{% url "posts:user_follow" %}',
      {
        id: $(this).data('id'),
        action: $(this).data('action')
      },
      function(data){
        if (data['status'] == 'ok') {
          var previous_action = $('a.follow').data('action');

          // toggle data-action
          $('a.follow').data('action',
            previous_action == 'follow' ? 'unfollow' : 'follow');
          // toggle link text
          $('a.follow').text(
            previous_action == 'follow' ? 'Unfollow' : 'Follow');

          // update total followers
          var previous_followers = parseInt(
            $('span.count .total').text());
          $('span.count .total').text(previous_action == 'follow' ?
          previous_followers + 1 : previous_followers - 1);

        //update total following
        var previous_following = parseInt(
            $('span.count1 .total1').text());
          $('span.count1 .total1').text(previous_action == 'follow' ?
          previous_following + 1 : previous_following - 1);
        }
      }
    );
  });
{% endblock %}